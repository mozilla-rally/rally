# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# This file defines the metrics that are recorded by the Glean SDK.
# APIs to use these pings are automatically generated at build time using
# the `glean_parser` PyPI package.

# Metrics in this file may make use of SDK reserved ping names. See
# https://mozilla.github.io/glean/book/dev/core/internal/reserved-ping-names.html
# for additional information.

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

rally:
  id:
    type: uuid
    lifetime: user
    send_in_pings:
      - study-enrollment
      - deletion-request
      - events
      - user-journey
      - advertisements
      - article-contents
      - youtube-video-details
      - youtube-video-recommendations
      - youtube-ads
      - tracking-pixel
      - attribution
    description: |
      The id of the Rally client. This is generated by
      the Rally SDKs. A value of 00000000-0000-0000-0000-000000000000
      indicates a test payload. A value of 11111111-1111-1111-1111-111111111111
      indicates that the Rally id was not found or properly set.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

user_journey:
  page_id:
    type: string
    description: |
      A unique ID associated with a page visit. Each
      page ID is 128-bit value, randomly generated with
      the Web Crypto API and stored as a hexadecimal
      string.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      The URL visited.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  referrer:
    type: url
    description: |
      The HTTP Referrer URL (if set).
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  page_visit_start_date_time:
    type: datetime
    time_unit: millisecond
    description: |
      When did the page visit start.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  page_visit_stop_date_time:
    type: datetime
    time_unit: millisecond
    description: |
      When did the page visit stop.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  attention_duration:
    type: quantity
    unit: milliseconds
    description: |
      How long the user attention event occurred
      (window/tab was focused and not idle).
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  audio_duration:
    type: quantity
    unit: milliseconds
    description: |
      How long a user audio event occurred.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  attention_and_audio_duration:
    type: quantity
    unit: milliseconds
    description: |
      How long a user audio event occurred while attention
      was focused on the tab.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  max_relative_scroll_depth:
    type: quantity
    unit: percentage
    description: |
      The largest depth reach on the page, as a
      proportion of the total page height.
    lifetime: ping
    send_in_pings:
      - user-journey
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

article_contents:
  page_id:
    type: uuid
    description: |
      A unique ID for this visit
    lifetime: ping
    send_in_pings:
      - article-contents
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      URL for the current page
    lifetime: ping
    send_in_pings:
      - article-contents
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  title:
    type: string
    description: |
      Title of the current page
    lifetime: ping
    send_in_pings:
      - article-contents
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  text_content:
    type: text
    description: |
      Contents of current page
    lifetime: ping
    send_in_pings:
      - article-contents
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

advertisements:
  page_id:
    type: uuid
    description: |
      A unique ID for this visit
    lifetime: ping
    send_in_pings:
      - advertisements
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      URL for the current page
    lifetime: ping
    send_in_pings:
      - advertisements
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  body:
    type: text
    description: |
      Body of the current page
    lifetime: ping
    send_in_pings:
      - advertisements
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

  ads:
    type: text
    description: |
      Metadata about any ads on this page
    lifetime: ping
    send_in_pings:
      - advertisements
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778196
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1778367
    notification_emails:
      - than@mozilla.com
    expires: never

youtube_video_details:
  page_id:
    type: uuid
    description: |
      A unique ID for this page visit
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      URL for the current page
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  author:
    type: string
    description: |
      The name of the video's author / channel
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  author_channel_id:
    type: string
    description: |
      The id of the video's author / channel
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  is_live_content:
    type: boolean
    description: |
      Whether or not this video is a live stream
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  contains_sponsored_content:
    type: boolean
    description: |
      Whether or not this video contains sponsored content.
      This is when the creator is paid to promote or endorse something.
      See: https://support.google.com/youtube/answer/10588440?nohelpkit=1
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  keywords:
    type: string_list
    description: |
      A list of keywords associated with the video
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  length:
    type: quantity
    unit: seconds
    description: |
      The length of the video in seconds
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  description:
    type: text
    description: |
      The video's description
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  title:
    type: string
    description: |
      The video's title
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  video_id:
    type: string
    description: |
      The id of the video (i.e. what comes after "watch?v=")
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  view_count:
    type: quantity
    unit: views
    description: |
      The number of views this video has
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  raw_data:
    type: text
    description: |
      A JSON object containing the raw data that was captured
    lifetime: ping
    send_in_pings:
      - youtube-video-details
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

youtube_video_recommendations:
  page_id:
    type: uuid
    description: |
      A unique ID for this page visit
    lifetime: ping
    send_in_pings:
      - youtube-video-recommendations
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      URL for the current page
    lifetime: ping
    send_in_pings:
      - youtube-video-recommendations
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  is_initial_set:
    type: boolean
    description: |
      Whether this is the first set of recommendations
      that was loaded on this page
    lifetime: ping
    send_in_pings:
      - youtube-video-recommendations
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  first_twenty_video_ids:
    type: string_list
    description: |
      A list of YouTube video IDs corresponding to the first
      20 video recommendations on this page.
      The limit of 20 is imposed by Glean.
      This metric is only set for the initial set of recommendations.
    lifetime: ping
    send_in_pings:
      - youtube-video-recommendations
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  details_list:
    type: text
    description: |
      A JSON array of all recommendations found
      along with some parsed details
    lifetime: ping
    send_in_pings:
      - youtube-video-recommendations
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

youtube_ad:
  page_id:
    type: uuid
    description: |
      A unique ID for this page visit
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  url:
    type: url
    description: |
      URL for the current page
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  type:
    type: string
    description: |
      The type of ad that was shown
      e.g. "instreamVideoAd"
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  ad_video_id:
    type: string
    description: |
      The YouTube video id of the ad's video,
      if this ad has associated video content
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  title:
    type: string
    description: |
      The ad's title text
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  description:
    type: string
    description: |
      The ad's short description text
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  body:
    type: text
    description: |
      The ad's body text
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  destination_url:
    type: url
    description: |
      The destination URL of the ad's call-to-action
      i.e. where you get sent if you click on the ad
      Note: this is usually a doubleclick.net or
      googleadservices link, with the actual destination
      at the end of the URL query parameters
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  advertiser_website:
    type: string
    description: |
      The advertiser's website
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  advertiser_info:
    type: text
    description: |
      A JSON object with any info about the advertiser that was
      scraped from the About This Ad URL, such as Name and Location.
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  targeting_reasons:
    type: text
    description: |
      A JSON object with a list of reasons that Google gave
      for why this ad was targeted to this user.
      Scraped from the About This Ad URL.
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  raw_data:
    type: text
    description: |
      A JSON object containing the raw data that was captured
    lifetime: ping
    send_in_pings:
      - youtube-ads
    bugs:
      - https://github.com/mozilla-rally/rally/issues/198
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

tracking_pixel:
  type:
    type: string
    description: |
      The type of pixel that was found.
      See tracking-pixels.ts for more details on the types of pixels.
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  origin_url:
    type: url
    description: |
      Where this pixel was fired from.
      Usually this is directly from the webpage, but sometimes it's
      through an intermediary. The page_id can be used to unequivocally
      determine the webpage URL if needed (via a user-journey lookup).
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  page_id:
    type: string
    description: |
      A unique ID associated with a page visit. Each
      page ID is 128-bit value, randomly generated with
      the Web Crypto API and stored as a hexadecimal
      string.
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  tracking_url:
    type: url
    description: |
      The pixel request url that the tracker used.
      This will often contain tracking information in the query string.
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  tracking_url_long:
    type: text
    description: |
      Same as "tracking_url", except this is used when the URL
      is longer than 2048 characters, due to limitations in Glean.
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

  form_data:
    type: text
    description: |
      Any HTTP POST form data sent along to the tracker.
    lifetime: ping
    send_in_pings:
      - tracking-pixel
    bugs:
      - https://github.com/mozilla-rally/rally/issues/167
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never

attribution:
  utm_codes:
    type: labeled_string
    labels:
      - source
      - medium
      - campaign
      - term
      - content
    send_in_pings:
      - attribution
    description: |
      Attribution information for the extension.
      This is set when the extension is first installed, any UTM codes present
      in extension store tabs matching the extension ID will be stored.
    bugs:
      - https://github.com/mozilla-rally/rally/issues/191
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1790817
    notification_emails:
      - than@mozilla.com
    expires: never
